# Session 2026-02-20

Summary:
- Diagnosed SDRAM issues: refresh was missing and address mapping was wrong for x16 SDRAM; fixed periodic refresh and switched to halfword-based address slicing (bank addr[24:23], row addr[22:10], col addr[9:1]) for word-aligned CPU.
- Found SDRAM address pin mismatch: QSF had A2/A3 swapped vs board table; swapping pins fixed aliasing pattern (0/4/8/12 test).
- Restored C memtest to full range (0x00001000–0x02000000) with progress printing; long memtest passes after refresh fix (leave end below stack if desired).
- Cleaned up demos: removed ad‑hoc asm tests, kept C memtest; added .gitignore entries for demo build artifacts and Quartus .cdf; added Quartus project files (.qpf/.sdc).
- Began Rust demo bring‑up: riscv-rt build produced no UART output; switched to custom Rust `_start` with local linker script to avoid CSR/runtime init; pending retest.

Key changes:
- lib/sdram/sdram_ctrl.vhd: add periodic refresh; set RFC_CYCLES=2; use halfword address mapping (addr[24:23]/[22:10]/[9:1]).
- projects/max1000_riscv/max1000_riscv.qsf: swap sdram_a[2] / sdram_a[3] to match board pin table.
- software/helloworld_c/main.c: full‑range memtest with % progress; stack print in memtest.
- .gitignore: ignore demo build outputs; ignore Quartus .cdf.
- software/helloworld_rust: add custom linker.ld, update .cargo/config.toml, replace riscv-rt with custom `_start` UART hello.

Commands/observations:
- Pattern test in ROM (0/4/8/12/...) showed aliasing; fixing A2/A3 mapping resolved it.
- Datasheet: W9825G6JH requires 8K refresh/64ms; used REFRESH_CYCLES=94 at 12 MHz.

Next steps:
- Rebuild Rust demo: `cd software/helloworld_rust && make clean && make`, update rom.vhd, recompile/program; expect UART output.
- If desired, build a ROM‑only memtest project that avoids any RAM use.
